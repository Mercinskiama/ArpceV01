
{% extends "ErpProject/ModuleStock/shared/layout.html" %}
{% block page %} {% load humanize %} {% load static %} {% load account_filters %} {% load calculs %}
{% load inventaire_filter %}
<style type="text/css">
    .kanban_image {
        width: 70px;
        height: 70px;
        display: inline-block;
        position: relative;
        text-align: center;
        background-size: contain;
    }
    .kanban_image[data-mimetype='application/pdf'] {
        background-image: url({% static 'ErpProject/image/mimetypes/pdf.svg' %});
    }
</style>
<div class="row">
    <ul class="breadcrumb">
        <li><a href="{% url 'backoffice_index' %}"><span class="mif-home"></span></a></li>
        <li><a class="chargement-au-click" href="{% url 'module_stock_index' %}">Module Stock</a></li>
        <li><a class="chargement-au-click" href="{% url 'module_stock_list_article' %}">Liste des Articles</a></li>
        <li>{{ title }}</li>
    </ul>
</div>

<div class="row">
    <div class="col-lg-12">
        <h2>{{ title }}</h2>
        
        <strong style="float: right;color: grey;opacity: 0.4;margin-top: -30px;">{% now "jS F Y H:i" %}</strong>
        <div class="separ" style="background-color: grey;opacity: 0.2"></div>
        
        <!-- GESTION DU WORKFLOW -->
        {% include 'ErpProject/ErpBackOffice/widget/workflow.html' with utilisateur=utilisateur model=model content_type_id=content_type_id historique=historique roles=roles etapes_suivantes=etapes_suivantes url_add="module_stock_add_article" url_detail="module_stock_detail_article" csrf_token=csrf_token module=module type_doc="Article" only %}
        <!--FIN GESTION DU WORKFLOW--> 

        <div class="panel panel-default" style="border: none; margin-top: 1rem;">
            <div class="panel panel-body" style="background-color:#f5f5f5;border: none;border-radius: none;">
                <div class="row">
                    <button onclick="javascript:window.location.assign('{% url 'module_stock_list_article' %}')" class="theme-btn theme-btn-sm rounded" style="width: 20%;margin-left: 5px">Retour</button>
                </div>

                <hr class="hr-ligne">
                <!-- Appel de la fonction message -->
                {% include 'ErpProject/ErpBackOffice/widget/message.html' with messages=messages only %}<br>
                
                <div class="col-md-12">
                    <div class="col-md-12">
                        <h3><center><strong>{{title}} {%if empl %} {{empl.designation}} {% endif %}</strong></center></h3>
                    </div>
                    <div class="col-md-6">
                        {% include 'ErpProject/ErpBackOffice/widget/organisation.html' %}
                    </div>
                    <div class="col-md-6" style="text-align: right;">
                        <form action="{% url 'module_stock_post_rapport_article_in_stock' %}" method="POST">
                            {% csrf_token %}
                            <input name="emplacement_origine_id" type="hidden" value="{{emplacement_origine_id}}">
                            <input name="inventaire_de" type="hidden" value="{{inventaire_de}}">
                            <input name="categorie_id" type="hidden" value="{{categorie_id}}">
                            <input name="article_id" type="hidden" value="{{article_id}}">
                            <input name="print" type="number" value="1" style="display:none">
                            <button type="submit" class="btn btn-default" style="background-color: #41435d;border:none;color: white;">
                                Imprimer
                            </button>
                        </form>
                    </div>
                    <div class="separ col-md-12" style="background-color: grey;opacity: 0.1;margin-bottom: 20px;"></div>
                    <div class="col-md-12">
                        <table class="display nowrap border bordered striped" cellspacing="0" style="width: 100%;">
                            <tr style="text-align:center;">
                                <td class="head"></td>
                                <td class="head">Article</td>
                                <td class="head">Quantité</td>
                                <td class="head">Unité de mesure</td>
                                <td class="head">Lieu</td>
                                <td class="head">Numéro de série</td>
                                <td class="head">Valeur d'inventaire</td>
                            </tr>
                                {% for item in model %}
                                    {% if item.stockage != None %}
                                        <tr class="tr-toggle main" id="{{ item.article.id }}" style="background-color:#DCDDFB;font-weight:700!important;text-align:center;height: 30px;" data-toggle="collapse" data-target=".article{{ item.article.id }}" daria-expanded="false">
                                            <td class="td"><i class="fa fa-caret-right"></i></td>
                                            <td class="td">{{ item.article}}</td>
                                            <!-- <td ></td> -->
                                            <td class="td"> {% if emplacement == 0 %}{{ item.article.disponible | sep_float }}{% else %} {{item.qte | sep_float }} {% endif %} </td>
                                            <td class="td">{{ item.article.measure_unit }}</td>
                                            <td colspan="2" class="td"></td>
                                            <td class="td"> {% if emplacement == 0 %}{{ item.article.valeur_inventaire | sep_float }}{% else %}{{item.val_inventaire | sep_float}}{% endif %} </td>
                                        </tr>

                                        {% for item2 in item.stockage %}

                                            {% if item2.quantite != 0  %}
                                                <tr class="tr-toggle collapse article{{ item.article.id }}" style="background-color:#d8d6d6;font-weight:700!important;text-align:center;height: 25px;" data-toggle="collapse" data-target=".stockage{{ item2.id }}" daria-expanded="false">
                                                    <td class="td"><span style="margin-left: 10px;"><i class="fa fa-caret-right icon{{ item.article.id }}"></i></span></td>
                                                    <td class="td">{{item2.article}}</td>
                                                    <td class="td">{{ item2.quantite | sep_float }} </td>
                                                    <td class="td"></td>
                                                    <td class="td">{{item2.emplacement}}</td>
                                                    <td class="td"></td>
                                                    <td class="td">{% multiply item2.quantite item.article.amount %}</td>
                                                </tr>
                                                {% if item.article.checkAsset == True %}
                                                    {% for item3 in item2.series_emplacement %}
                                                        <tr class="collapse stockage{{ item2.id }} main{{ item.article.id }}" style="text-align:center;height: 22px;">
                                                            <td class="td"></td>
                                                            <td class="td">{{ item2.article.designation }} </td>
                                                            <td class="td" style="text-align: center" >{{item2.quantite}}</td>
                                                            <td class="td">{{ item.article.measure_unit }}</td>
                                                            <td class="td">{{ item3.emplacement.designation }}</td>
                                                            <td class="td">{{ item3.numero_serie }}</td>
                                                            <td class="td" style="text-align: center" >{{ item3.article.amount | sep_float  }}</td>
                                                        </tr>
                                                    {% endfor %}
                                                {% else %}
                                                    <tr class="collapse stockage{{ item2.id }} main{{ item.article.id }}" style="text-align:center;height: 22px;">
                                                        <td class="td"></td>
                                                        <td class="td">{{ item2.article.designation }} </td>
                                                        <td class="td" style="text-align: center" >{{ item2.quantite | sep_float }}</td>
                                                        <td class="td">{{ item.article.measure_unit }}</td>
                                                        <td class="td">{{ item2.emplacement.reference }}</td>
                                                        <td class="td"></td>
                                                        <td class="td" style="text-align: center" >{% multiply item2.quantite item.article.amount %}</td>
                                                    </tr>
                                                {% endif %}
                                            {% endif %}

                                        {% endfor %}
                                    {% endif %}
                                {% endfor %}
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    //-------  Deux variables pour la suppression  ---------------
    var modele = "Model_Article"
    var the_url = "module_stock_list_article"
</script>

<script>

    $(document).ready(function(){

        $("tr > td > i").removeClass("fa-caret-down");
        $("tr > td > i").addClass("fa-caret-right");
        $("tr > td > i").data("show", false);

        $(".tr-toggle").click(function() {
            var icone = $(this).find("i");
            if (icone.data("show") === true) {
                icone.removeClass("fa-caret-down");
                icone.addClass("fa-caret-right");
                icone.data("show", false);

            } else {
                icone.removeClass("fa-caret-right");
                icone.addClass("fa-caret-down");
                icone.data("show", true);
            }
        });

        $(".main").click(function() {
            var icone = $(this).find("i");
            if (icone.data("show") === true) {

            }else {

                id = $(this).attr('id');

                el = $('.main'+id);
                el.removeClass('in');
                el.attr('aria-expanded','false');

                ic = $('.icon'+id);
                ic.removeClass("fa-caret-down");
                ic.addClass("fa-caret-right");
                ic.data("show", false);
            }
        });

    });
</script>



{% include 'ErpProject/ErpBackOffice/widget/item_view.html' %}
{% endblock %}